<!-- 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
jquery_test_13.html
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 -->
  <html><meta charset="UTF-8">
	<head>
		<script type="text/javascript" src="jquery-1.11.0.min.js"></script>
		<script language="JavaScript">
		
		$(document).ready(function(){

			 
			// (M.ver)
			//-------------------------------------------
			// skillsObj 변수 선언, id="skills"를 관리하는 JQuery 객체 생성하여 메위주 저장
			//-------------------------------------------
			var skillsObj = $("#skills");
			
			//-------------------------------------------
			// skillsObj가 관리하는 태그들의 후손 중 select 태그의 change 이벤트 처리
			//-------------------------------------------
			skillsObj.find("select").change(function() {

				//-------------------------------------------
				// <1> thisObj 변수 선언, 현재 선택한 select 태그를 관리하는 JQuery 객체 생성하여 메위주 저장
				// <2> thisValue 변수 선언, thisObj의 value 값 저장
				// <3> optionStr 변수 선언, thisObj의 html 값 문자열로 리턴 받아 저장
				// <4> valueArr 변수 선언, Array 객체 생성 후 메위주 저장
				//-------------------------------------------
				var thisObj = $(this);				// <1>
				var thisValue = thisObj.val();		// <2>
				var optionStr = thisObj.html();		// <3>
				var valueArr = [];					// <4>
				
				//-------------------------------------------
				// thisObj의 이전 형제 태그에 각각 접근하여 value="" 인 경우 alert() 처리
				// <1> thisOb의 선택값을 value=''로 선택하도록 변경
				// <2> thisValue 변수에 "" 데이터 저장
				// <3> each문을 벗어남
				//-------------------------------------------	
				thisObj.prevAll().each(function(i) {
					if($(this).val() == "") {
						alert("앞의 소유스킬을 먼저 선택해 주세요.");
						thisObj.find("[value='']").prop("selected", true);	// <1>	
						thisValue = "";										// <2>
						return false;										// <3>
					}
				});

				//-------------------------------------------
				// 각 select 태그에 접근하여 valueArr 변수의 value 값 저장
				//-------------------------------------------
				skillsObj.find("select").each(function(i) {
					valueArr.push($(this).val());
				});

				//-------------------------------------------
				// thisObj의 이후 형제 태그에 각각 접근하여 설정
				//-------------------------------------------
				thisObj.nextAll().each(function(i) {
					//-------------------------------------------
					// <1> nextThisObj 변수 선언, 접근한 select 태그를 관리하는 JQuery 객체 생성하여 메위주 저장
					// <2> nextValue 변수 선언, nextThisObj의 value 값 저장
					// <3> nextIndex 변수 선언, nextThisObj의 index 값 저장
					//-------------------------------------------
					var nextThisObj = $(this);				// <1>
					var nextValue = nextThisObj.val();		// <2>
					var nextIndex = nextThisObj.index();	// <3>

					console.log("===========================================");

					//-------------------------------------------
					// nextThisObj의 후손을 삭제
					// nextThisObj의 태그 안에 optionStr에 저장되어 있는 문자열을 추가한다.
					//-------------------------------------------	
					nextThisObj.empty();
					nextThisObj.html(""+ optionStr +"");


					// -------------------------------------------------------
					// select 추가되어도 사용할 수 있게 수정중
					// -------------------------------------------------------

					if(thisValue != "") {
						nextThisObj.find("[value='"+ thisValue + "']").remove();
						console.log(1);
					} else if(thisValue == "") {
						nextThisObj.find("[value='']").prop("selected", true);
						console.log(2);
					}

					for(var j = 0; j < valueArr.length; j++){
						for(var k = j+1; k < valueArr.length; k++){
							if(valueArr[j] != nextValue && valueArr[k] != "") {
								nextThisObj.find("[value='"+ nextValue + "']").prop("selected", true);
								console.log(3);
							}

							if(nextIndex == k && valueArr[j] != "" && (valueArr[k] != "" || valueArr[k] == "")){
								nextThisObj.find("[value='"+ valueArr[1] + "']").remove();
								console.log(4);
							} 

							if(nextIndex == k && valueArr[j] == "") {
								nextThisObj.find("[value='']").prop("selected", true);
								console.log(5);
							}
						}
					}

					// -------------------------------------------------------
					// select 추가되어도 사용할 수 있게 수정중 여기까지!!
					// -------------------------------------------------------

					/*

					// select 태그들이 추가되어도 할 수 있도록 수정해보자
					// 단, select 태그들이 추가되는 개수는 option 태그의 개수를 넘길 수는 없다
					
					if(thisValue != "") {
						nextThisObj.find("[value='"+ thisValue + "']").remove();
					} 

					if(nextIndex == 1 && valueArr[1] != "" && valueArr[0] != nextValue) {
						nextThisObj.find("[value='"+ nextValue + "']").prop("selected", true);
					}

					if(nextIndex == 2 && valueArr[1] != "" && valueArr[0] != nextValue) {
						nextThisObj.find("[value='"+ nextValue + "']").prop("selected", true);
					}

					if(nextIndex == 2 && valueArr[1] != "" && valueArr[2] != "") {
						nextThisObj.find("[value='"+ valueArr[1] + "']").remove();
					}

					if(nextIndex == 2 && valueArr[1] != "" && valueArr[2] == "") {
						nextThisObj.find("[value='"+ valueArr[1] + "']").remove();
					}

					if(nextIndex == 2 && valueArr[1] == "" ) {
						nextThisObj.find("[value='']").prop("selected", true);
					}
					
					if(thisValue == "") {
						nextThisObj.find("[value='']").prop("selected", true);
					}

					*/

					valueArr[nextIndex] = nextThisObj.val();

				});
				
			});


				
			/*
			// hide(), show() 로 하려 했는제 fail..

			var skillsObj = $("#skills");
			
			//-------------------------------------------
			// skillsObj가 관리하는 태그들의 후손 중 select 태그의 change 이벤트 처리
			//-------------------------------------------
			skillsObj.find("select").change(function() {	
				//-------------------------------------------
				// <1> thisObj 변수 선언, 선택한 select 태그를 관리하는 JQuery 객체 생성하여 저장
				// <2> selectValue 변수 선언, 선택한 value 저장
				// <3> prevValue 변수 선언, 이전에 선택된 값이 있을 경우 value 저장
				// <4> nextAllObj 변수 선언, 선택된 select 태그 다음에 나오는 형제들의 
				//	select 태그를 관리하는 JQuery 객체 생성하여 저장
				//-------------------------------------------
				var thisObj = $(this);					// <1>
				var thisValue = thisObj.val();			// <2>
				// var prevValue = thisObj.prev().val();	// <3>
				var prevAllObj = thisObj.prevAll();		// <4>
				var nextAllObj = thisObj.nextAll();		// <4>
				var prevValueArr = [];
				var nextValueArr = [];


				//-------------------------------------------
				// 선택한 select 태그 이전에 나온 select 태그들이 선택한 값 저장
				//-------------------------------------------
				prevAllObj.each(function(i){
					prevValueArr.push($(this).val());
				});

				//-------------------------------------------
				// 선택한 select 태그 다음에 나온 select 태그들이 선택한 값 저장
				//-------------------------------------------
				nextAllObj.each(function(i){
					nextValueArr.push($(this).val());
				});

				//-------------------------------------------
				// nextAllObj가 관리하는 태그 후손 중 option태그를 보이기
				//-------------------------------------------
				nextAllObj.find("option").show();
				
				//-------------------------------------------
				// <1> nextAllObj가 관리하는 태그 후손 중 value값을 '' 으로 선택하게 하기
				//-------------------------------------------
				// nextAllObj.find("[value='']").prop("selected", true);
				
				// 이미 선택된 값인 경우 다음 select 박스 안보이게
				// 세번째 값을 첫번째 값이 선택 시 두번째 셀렉트 박스는 보이게 수정해야함
				// for(var j = 0; j < nextValueArr.length; j++){
				// 	if(thisValue == nextValueArr[j]) {
				// 		nextAllObj.find("[value='']").prop("selected", true);
				// 	} else if(thisValue == ""){{
				// 		nextAllObj.find("[value='']").prop("selected", true);
				// 	}}
				// }
				
				//-------------------------------------------
				// nextAllObj가 관리하는 태그 후손 중 value=thisValue 값을 가진 태그 안보이게 처리
				// nextAllObj가 관리하는 태그 후손 중 value=prevValue 값을 가진 태그 안보이게 처리
				//-------------------------------------------
				// nextAllObj.find("[value='"+ thisValue + "']").hide();
				// nextAllObj.find("[value='"+ prevValue + "']").hide();

				//-------------------------------------------
				// nextAllObj가 관리하는 태그가 각각 접근하여 이전에 선택한 값 하이드 처리
				// i가 1인 경우 
				//-------------------------------------------
				nextAllObj.each(function(i){
					var nextThisObj = $(this);

					if(thisValue == nextThisObj.val()){
						nextThisObj.find("[value='']").prop("selected", true);
					}

					// if(thisValue == ""){
					// 	nextThisObj.find("[value='']").prop("selected", true);
					// }

					nextThisObj.find("[value='"+ thisValue + "']").hide();
					// 이전에 선택한 값 숨기기
					for(var j = 0; j < prevValueArr.length; j++){
						nextThisObj.find("[value='"+ prevValueArr[j] + "']").hide();
						if(prevValueArr[j] == ""){
							nextThisObj.find("[value='']").prop("selected", true);
							nextValueArr[j] == "";
						}
					}
					// 여기 좀 이상함
					if(i == 1){
						nextThisObj.find("[value='"+ nextValueArr[0] + "']").hide();
						if(nextThisObj.prev().val() == ""){
							nextThisObj.find("[value='']").prop("selected", true);
						}
					}
				});

				// 선택한 태그 이전 형제 select 태그에 선택된 값이 없을 경우

				// prevAll 의 값이 '' 인 상태에서 thisObj의 값을 선택하려 했을 경우 alert

				//-------------------------------------------
				// '' 무조건 보이기
				//-------------------------------------------
				nextAllObj.find("[value='']").show();
			});
			*/

			/*
			// (T.vel)
			//-------------------------------------------
			// id="skills" 를 가진 태그의 아들 중 name="skill~"를 가진 태그들에
			// change 이벤트가 발생하면 실행할 코드 설정
			//-------------------------------------------
			$("#skills").children("[name^=skill]").change(function(){
				//-------------------------------------------
				// <1> selectObj 변수 선언, change 이벤트가 발생한 select 태그를 관리하는 
				//	JQuery 객체의 메위주를 얻어 저장하기
				// <2> choicedVal 변수 선언, change 이벤트가 발생한 select 태그의 현재 선택값 저장
				// <3> idx 변수 선언, change 이벤트가 발생한 select 태그의 형제 중 나의 인덱스 번호 저장
				// <4> values 변수 선언, change 이벤트가 발생한 select 태그의 선택값과 형제들의 선택값을 저장할 
				//	Array 객체 생성하고 선택값을 구해서 Array 객체에 저장
				// <5>
				//-------------------------------------------
				var selectObj = $(this);							// <1>
				var choicedVal = selectObj.val();					// <2>
				var idx = selectObj.index();						// <3>
				var values = [];									// <4>
				var allSelectObj = selectObj.parent().children("[name^=skill]"); 	// <5>

				//-------------------------------------------
				allSelectObj.each(function(){
					var value = $(this).val();
					if(value == null || value == ""){
						values.push("");
					} else {
						values.push(value);
					}
				});

				//-------------------------------------------
				// i번째 select 태그와 ii 번째 select 태그와의 선택값 관계가 
				// 이상이 있으면 선택값을 비운다.
				//-------------------------------------------
				for( var i = 0; i < values.length; i++ ){
					for( var ii = i+1; ii < values.length; ii++ ){
						//-------------------------------------------
						// i번째 select 태그의 선택값은 없는데 
						// ii번째 select 태그의 선택값은 있다면
						// 즉, i번째 형은 없는데 ii번째 동생은 있다면
						//-------------------------------------------
						if( values[i] == ""  && values[ii] != "" ) {
							// i번째 select 태그 이후의 모든 select 태그의 value 값을 비우기
							allSelectObj.eq(i).nextAll().val('');
						}
						//-------------------------------------------
						// i번째 select 태그의 선택값이 있고 
						// i번째 select 태그의 선택값과 ii번째 select 태그의 선택값이 같으면
						// 즉, i번째 형의 값과 ii번째 동생의 값이 같으면
						//------------------------------------------- 
						else if( values[i] != "" && values[i] == values[ii] ) {
							// ii번째 select 태그부터 시작해서 그 이후의 모든 select 태그의 value 값을 비우기
							allSelectObj.eq(ii-1).nextAll().val('');
						}

					}
				}

				//-------------------------------------------
				// 형이 가진 option 태그를 복사해 바로 아래 동생의 select 태그안에 덮에 씌우고
				// 형이 선택한 데이터가 있으면 그 데이터를 가진 option 태그를 지우기
				//-------------------------------------------
				for( var i=0; i < allSelectObj.length-1; i++ ) {
					//-------------------------------------------
					// <1> nowValue 변수 선언, i번째 select 태그의 선택값을 얻기
					// <2> i+1번째 select 태그의 선택값을 얻어서 변수에 저장하기
					//-------------------------------------------
					var nowValue = allSelectObj.eq(i).val();		// <1>
					var nextValue = allSelectObj.eq(i+1).val();		// <2>
					
					//-------------------------------------------	
					// <1> i번째 select 태그가 가진 option 태그를 복사해 i+1 번째 select 태그의 안에 덮어 씌우기
					//-------------------------------------------	
					allSelectObj.eq(i+1).html( allSelectObj.eq(i).html() );

					// i번째 select 태그의 선택값이 있으면
					if( nowValue != "" ) {
						// i+1 번째 select 태그 내부의 option 태그 중 
						// i번째 select 태그의 선택값을 가진 option 태그를 지우기
						allSelectObj.eq(i+1).children().filter("[value='" + nowValue + "']").remove();

						// i+1번째 select 태그에 선택값이 있었다면 그 값을 다시 선택하게 하기
						if( nextValue != "" ){
							allSelectObj.eq(i+1).val(nextValue);
						}
					} 
					// i번째 select 태그의 선택값이 없으면
					else {
						// i+1번째 select 태그의 선택값 지우기
						allSelectObj.eq(i+1).val("");
					}
				}

			});
			*/

		});
</script>
	</head>
	<body>
		<!---------------------------------------------------------------->
		<span id="skills">
		[소유스킬] :
		<select name="skill1">
			<option value="">
			<option value="JSP">JSP
			<option value="ASP">ASP
			<option value="PHP">PHP
			<option value="Oracle">Oracle
			<option value="Java">Java
		</select>
		<select name="skill2">
			<option value="">
			<option value="JSP">JSP
			<option value="ASP">ASP
			<option value="PHP">PHP
			<option value="Oracle">Oracle
			<option value="Java">Java
		</select>
		<select name="skill3">
			<option value="">
			<option value="JSP">JSP
			<option value="ASP">ASP
			<option value="PHP">PHP
			<option value="Oracle">Oracle
			<option value="Java">Java
		</select>
		</span>
	</body>
</html>